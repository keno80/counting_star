# PRD｜记账软件（Counting Star）

## 1. 文档信息
| 项目 | 内容 |
| --- | --- |
| 文档名称 | 记账软件 PRD |
| 版本 | v0.1 |
| 状态 | 初稿（基于功能清单生成，后续按实现调整） |
| 更新日期 | 2026-01-19 |

## 2. 背景与问题
- 个人/家庭/小团队需要低门槛记录收支，形成可回顾的消费结构与资产变化
- 现有工具常见问题：记账成本高、查询不便、统计口径不一致、数据迁移困难

## 3. 目标与成功指标
### 3.1 产品目标
- 快速完成一笔收支/转账记录，支持回溯与纠错
- 支持按账户/分类/标签/商家维度的查询与统计
- 支持本地备份与导出，确保数据可携带

### 3.2 成功指标（建议口径）
- 关键路径完成率：新增一笔流水成功保存 ≥ 99%
- 记录效率：从打开“记一笔”到保存完成中位时长 ≤ 15 秒（熟练用户）
- 数据可用：备份恢复成功率 ≥ 99%

## 4. 用户与场景
### 4.1 用户画像
- 个人用户：日常收支记录，关注分类统计与月度结余
- 家庭用户（可选）：多成员分摊与共同预算
- 轻量理财用户：关注多账户余额、净资产趋势

### 4.2 核心场景
- 买菜/通勤等小额高频支出，快速记账
- 月末复盘：本月花费去向、Top 分类、预算是否超支
- 账户整理：银行卡/现金/信用卡余额核对与调整
- 数据迁移：导出或从第三方账单导入（可选）

## 5. 范围与版本规划
### 5.1 MVP（P0）
- 账本与账户：账本基础管理；账户管理；转账；余额调整
- 分类/标签/商家：收入/支出分类；标签；商家（基础）
- 流水：收入/支出/转账；编辑/删除；拆分记账（可先做单层拆分）
- 列表与查询：时间分组列表；搜索与筛选；详情页
- 统计：月度概览（收入/支出/结余）；分类统计（基础）
- 数据：CSV 导出；本地备份与恢复

### 5.2 增强（P1）
- 预算：总预算/按分类预算；进度与提醒
- 统计：账户余额趋势；净资产；更多维度聚合
- 体验：模板/复制上一笔；批量操作；回收站（可选）

### 5.3 可选增强（P2）
- 附件、退款/冲正、分摊、定时记账、自动归类、快捷入口
- 多端登录与同步、共享账本协作
- 加密存储/生物识别解锁、操作审计

## 6. 信息架构（IA）
- 首页/概览
- 记一笔
- 流水
- 统计
- 账本与账户
- 分类/标签/商家管理
- 数据（导入/导出/备份）
- 设置

## 7. 业务流程（核心）
### 7.1 新增一笔（收入/支出）
1) 用户进入“记一笔”
2) 选择类型（收入/支出）
3) 输入金额、选择账户、选择分类，补充日期时间/备注/标签/商家（可选）
4) 保存成功后：
- 流水列表新增记录
- 账户余额按规则变更
- 统计口径在对应周期内更新

### 7.2 转账
1) 选择类型“转账”
2) 选择转出账户、转入账户、金额、日期时间、备注（可选）
3) 保存后：
- 生成一笔转账流水（建议内部拆为两条明细但对用户展示为一笔）
- 转出账户减少、转入账户增加
- 不计入收入/支出统计（口径见 10.2）

### 7.3 编辑/删除
- 编辑：保留流水 ID，更新字段；账户余额做差量回滚再重算（或重算策略）
- 删除：默认硬删除（MVP）；P1 可做回收站软删除

## 8. 页面与交互（文字原型）
### 8.1 首页/概览
- 显示：本月收入/支出/结余；可切换周期（本月/上月/自定义）
- 快捷入口：记一笔、转账、查看流水、查看统计

### 8.2 记一笔页
- 顶部切换：支出 / 收入 / 转账
- 核心输入：金额（必填）
- 选择项：
  - 支出/收入：账户（必填）、分类（必填）
  - 转账：转出账户（必填）、转入账户（必填，且不同于转出）、金额（必填）
- 可选项：日期时间、备注、标签、商家、附件（P2）
- 保存校验：必填校验、金额 > 0、转账账户不能相同

### 8.3 流水列表
- 默认按时间倒序，按日分组
- 支持：搜索（备注/商家/标签关键字）、筛选（账户/分类/标签/日期范围/金额区间）
- 条目展示：类型、金额、分类/转账方向、账户、时间、备注摘要（可选）

### 8.4 流水详情
- 展示全部字段
- 操作：编辑、删除
- 转账展示：转出→转入；退款/冲正/拆分/分摊（P2）展示关联关系

### 8.5 统计
- 概览：周期内收入/支出/结余
- 分类统计：按支出分类（默认）与收入分类切换；Top 列表
- 时间范围：本月/上月/近 3 月/自定义

### 8.6 账本与账户
- 账本：列表；新建/编辑/删除/归档；设为默认
- 账户：账户列表与余额；新建/编辑；启用/停用；余额调整；转账入口

### 8.7 分类/标签/商家管理
- 分类：收入/支出分栏；两级分类；排序；常用置顶；合并/迁移（P1）
- 标签：创建/编辑/删除；多选用于流水
- 商家：常用列表；用于流水联想（P1）

### 8.8 数据（导出/备份/恢复）
- 导出：CSV（MVP）；可按时间范围/账本筛选（P1）
- 备份：生成备份文件；展示最近备份记录
- 恢复：选择备份文件；提示覆盖/合并策略（MVP 先覆盖）

## 9. 权限与多账本
- MVP 默认单用户、单设备
- 多账本：同一用户可创建多个账本，数据隔离
- 共享与协作（P2）：成员角色（管理员/编辑/只读），编辑产生操作日志（P2）

## 10. 数据模型（建议）
### 10.1 基础实体
- 账本 Ledger：id、name、isArchived、createdAt、updatedAt
- 账户 Account：id、ledgerId、name、type、currency、initialBalance、currentBalance、isActive、creditBillingDay（可选）、creditRepaymentDay（可选）、creditLimit（可选）
- 分类 Category：id、ledgerId、type（income/expense）、parentId（可选）、name、sort、isPinned
- 标签 Tag：id、ledgerId、name、color（可选）、icon（可选）
- 商家 Merchant：id、ledgerId、name、alias（可选）

### 10.2 流水 Transaction
- 字段：id、ledgerId、type（income/expense/transfer）、amount、currency、occurredAt、note、accountId（income/expense）、categoryId（income/expense）、tagIds、merchantId（可选）
- 转账字段：fromAccountId、toAccountId
- 状态字段（可选）：isDeleted（回收站）、deletedAt

### 10.3 附件（P2）
- Attachment：id、transactionId、type、uri、createdAt

### 10.4 预算与提醒（P1）
- Budget：id、ledgerId、period（month/week）、startAt、endAt、totalAmount（可选）、categoryBudgets（可选：categoryId->amount）
- Reminder：id、ledgerId、type、schedule、payload、isEnabled

### 10.5 备份（MVP）
- BackupRecord：id、createdAt、fileName、checksum（可选）、size

## 11. 规则与口径
### 11.1 金额与币种
- MVP 默认单币种（与账本一致）；多币种作为 P2
- 金额精度：至少支持 2 位小数，内部建议使用整数分存储

### 11.2 统计口径
- 支出统计：type=expense 的流水金额求和
- 收入统计：type=income 的流水金额求和
- 结余：收入 - 支出
- 转账：不计入收入/支出/结余，仅影响账户余额

### 11.3 账户余额变更
- 新增支出：account.balance -= amount
- 新增收入：account.balance += amount
- 新增转账：from.balance -= amount；to.balance += amount
- 编辑/删除：需按差量回滚或基于流水重算，保证余额一致性

### 11.4 拆分记账（P0）
- 一笔拆分为多条子明细（分类/标签/金额各自独立）
- 校验：子明细金额之和 = 原始金额
- 列表展示：默认展示为一笔，可展开查看子明细（P1）

### 11.5 退款/冲正（P2）
- 退款关联原流水，生成反向金额并回写关联关系

## 12. 导出与备份格式（建议）
### 12.1 CSV 导出（MVP）
字段建议：id、type、amount、currency、occurredAt、account、category、tags、merchant、note、fromAccount、toAccount

### 12.2 备份文件（MVP）
- 建议使用单文件打包：包含账本、账户、分类、标签、商家、流水
- 恢复策略：MVP 先“覆盖恢复”；P1 增加“合并恢复 + 冲突处理”

## 13. 异常与边界
- 金额输入：非数字、负数、过大值、精度超限
- 转账：转出=转入时禁止保存
- 删除账户/分类：若存在引用，提示迁移或禁止删除（MVP 可先禁止）
- 数据恢复：文件损坏/校验失败提示；恢复前提示覆盖风险

## 14. 非功能性需求
- 性能：流水列表 1 万条以内滚动流畅；统计在 1 秒内出结果（目标值）
- 可靠性：关键操作（新增/编辑/删除/恢复）具备失败提示与可重试
- 可用性：空状态引导；错误提示明确；避免误操作（P1 增加撤销/回收站）
- 可测试性：统计与余额口径可单测；导出字段稳定

## 15. 埋点与日志（建议）
- 关键事件：新增流水、编辑流水、删除流水、导出、备份、恢复
- 维度：入口来源（首页/列表/快捷）、流水类型、是否拆分、是否失败及原因

## 16. 里程碑（建议）
- M1：基础数据结构 + 记一笔 + 列表（P0）
- M2：统计（概览/分类）+ 导出 + 备份恢复（P0）
- M3：预算与批量/模板体验增强（P1）
- M4：同步/协作/自动化（P2）

## 17. 风险与待定项
- 统计与余额一致性策略（差量回滚 vs 全量重算）
- 备份恢复的“合并”规则与冲突处理复杂度
- 导入（第三方账单）字段映射与幂等策略（P2）

