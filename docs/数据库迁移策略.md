# 数据库迁移策略（Room migration）

## 目标

- 版本可追溯、可回滚
- 保障数据不丢失
- 可在 CI 中自动验证

## 基本规则

- 每次 schema 变更必须提升 version
- 提供对应 Migration，禁止 fallbackToDestructiveMigration
- exportSchema 开启并提交 schema 文件

## 版本策略

- 初始版本 = 1
- 每次新增字段/表/索引递增版本

## 迁移流程

- 新增 Migration(OLD, NEW)
- 在 DatabaseBuilder 注册所有 Migration
- 为每个 Migration 编写测试

## 回滚策略

- 仅允许前进迁移
- 版本回退通过恢复备份完成

## 校验

- 使用 Room migration test helper
- 在 CI 中运行迁移测试
